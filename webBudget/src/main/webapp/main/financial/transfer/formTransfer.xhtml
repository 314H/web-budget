<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                xmlns:pe="http://primefaces.org/ui/extensions"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                template="/template/default.xhtml">

    <ui:define name="head">
        <f:event type="preRenderView" 
                 listener="#{transferenceBean.initializeForm()}" />
    </ui:define>

    <ui:define name="content">

        <h:form id="transferForm" prependId="false">

            <p:messages id="messages" closable="true" globalOnly="true" />
            <pe:tooltip global="true" myPosition="left center" atPosition="right center" for="@(.ui-state-error)"/> 

            <div class="form-box-wrapper">
                <div class="left-form-box" style="width: 70% !important">
                    <div class="form-cell">
                        <p:outputLabel for="inValue" 
                                       value="#{i18n['transfer.form.value']}: "/>
                        <br/>
                        <pe:inputNumber id="inValue" 
                                        decimalPlaces="2" 
                                        decimalSeparator="," 
                                        thousandSeparator="." 
                                        style="text-align: right"
                                        value="#{transferenceBean.walletBalance.transferValue}"
                                        title="#{component.valid ? '' : transferenceBean.getErrorMessage(component.clientId)}">
                            <pe:keyFilter regEx="/[0-9_,]/i"/>
                            <f:converter converterId="javax.faces.BigDecimal" />
                        </pe:inputNumber>
                    </div>
                    <div class="form-cell">
                        <p:outputLabel for="inWalletSource" 
                                       value="#{i18n['transfer.form.wallet-source']}: "/>
                        <br/>
                        <p:selectOneMenu id="inWalletSource" 
                                         style="width: 250px"
                                         converter="omnifaces.SelectItemsConverter"
                                         value="#{transferenceBean.walletBalance.sourceWallet}">
                            <p:ajax event="change" update="sourceBalancePanel" />
                            <f:selectItem itemValue="#{null}"
                                          noSelectionOption="true"
                                          itemLabel="#{i18n['transfer.form.select-one']}" />
                            <f:selectItems var="wallet"
                                           itemValue="#{wallet}"
                                           itemLabel="#{wallet.friendlyName}"
                                           value="#{transferenceBean.wallets}"/>
                        </p:selectOneMenu>
                    </div>
                    <div class="form-cell">
                        <p:outputLabel for="inWalletDestiny" 
                                       value="#{i18n['transfer.form.wallet-destiny']}: "/>
                        <br/>
                        <p:selectOneMenu id="inWalletDestiny" 
                                         style="width: 250px"
                                         converter="omnifaces.SelectItemsConverter"
                                         value="#{transferenceBean.walletBalance.wallet}">
                            <p:ajax event="change" update="destinyBalancePanel" />
                            <f:selectItem itemValue="#{null}"
                                          noSelectionOption="true"
                                          itemLabel="#{i18n['transfer.form.select-one']}" />
                            <f:selectItems var="wallet"
                                           itemValue="#{wallet}"
                                           itemLabel="#{wallet.friendlyName}"
                                           value="#{transferenceBean.wallets}"/>
                        </p:selectOneMenu>
                    </div>
                </div>
                <div class="rigth-form-box" style="width: 30% !important">
                    <div class="form-cell">
                        <p:fieldset legend="#{i18n['transfer.form.source-balance']}">
                            <h:panelGroup id="sourceBalancePanel"
                                          layout="block"
                                          style="margin: 5px 0 5px 0">
                                <h:outputText value="R$ #{transferenceBean.walletBalance.sourceWallet.balance}"
                                              rendered="#{transferenceBean.walletBalance.sourceWallet ne null}"
                                              style="#{transferenceBean.walletBalance.sourceWallet.balance.signum() 
                                                       lt 0 ? 'color: red;' : 'color: green;'}"/>
                                <h:outputText value="#{i18n['transfer.form.select-source']}"
                                              rendered="#{transferenceBean.walletBalance.sourceWallet eq null}"/>
                            </h:panelGroup> 
                        </p:fieldset>
                        <p:spacer height="10" />
                        <p:fieldset legend="#{i18n['transfer.form.destiny-balance']}">
                            <h:panelGroup id="destinyBalancePanel"
                                          layout="block"
                                          style="margin: 5px 0 5px 0">
                                <h:outputText rendered="#{transferenceBean.walletBalance.wallet ne null}"
                                              value="R$ #{transferenceBean.walletBalance.wallet.balance}"
                                              style="#{transferenceBean.walletBalance.wallet.balance.signum() 
                                                       lt 0 ? 'color: red;' : 'color: green;'}"/>
                                <h:outputText value="#{i18n['transfer.form.select-destiny']}"
                                              rendered="#{transferenceBean.walletBalance.wallet eq null}"/>
                            </h:panelGroup> 
                        </p:fieldset>
                    </div>
                </div>
            </div>
            <div class="form-controls-box">
                <p:commandButton update="transferForm"
                                 process="transferForm"
                                 styleClass="green-button"
                                 value="#{i18n['form.transfer']}"
                                 actionListener="#{transferenceBean.doTransference()}"/>
                <p:spacer width="10"/>
                <p:commandButton immediate="true"
                                 styleClass="red-button"
                                 value="#{i18n['form.back']}"
                                 style="width: 100px !important"
                                 action="#{transferenceBean.doCancel()}"/>
            </div>
        </h:form>
    </ui:define>
</ui:composition>
