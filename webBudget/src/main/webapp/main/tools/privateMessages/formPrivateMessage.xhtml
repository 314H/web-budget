<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                xmlns:pe="http://primefaces.org/ui/extensions"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                template="/template/default.xhtml">

    <ui:define name="head">
        <f:event type="preRenderView" 
                 listener="#{privateMessageBean.initializeForm(param.privateMessageId)}" />
    </ui:define>

    <ui:define name="content">

        <h:form id="privateMessageForm" prependId="false">

            <p:messages id="messages" closable="true" globalOnly="true" />
            <pe:tooltip global="true" myPosition="left center" atPosition="right center" for="@(.ui-state-error)"/>  

            <h:panelGroup id="formWrappper" 
                          layout="block" 
                          styleClass="form-box-wrapper">
                <div class="left-form-box">
                    <div class="form-cell">
                        <p:outputLabel for="inCode" 
                                       value="#{i18n['private-message.form.code']}: "/>
                        <br/>
                        <p:inputText id="inCode" 
                                     readonly="true"
                                     value="#{privateMessageBean.privateMessage.code}"/>
                    </div>
                    <div class="form-cell">
                        <p:outputLabel for="inOwner" 
                                       value="#{i18n['private-message.form.owner']}: "/>
                        <br/>
                        <p:inputText id="inOwner" 
                                     readonly="true"
                                     style="width: 350px"
                                     value="#{privateMessageBean.privateMessage.owner.name}" 
                                     title="#{component.valid ? '' : privateMessageBean.getErrorMessage(component.clientId)}"/>
                    </div>
                    <div class="form-cell">
                        <p:outputLabel for="inTitle" 
                                       value="#{i18n['private-message.form.title']}: "/>
                        <br/>
                        <p:inputText id="inTitle" 
                                     maxlength="45"
                                     style="width: 350px"
                                     value="#{privateMessageBean.privateMessage.title}" 
                                     title="#{component.valid ? '' : privateMessageBean.getErrorMessage(component.clientId)}"/>
                    </div>
                    <div class="form-cell">
                        <p:outputLabel for="inText" 
                                       value="#{i18n['private-message.form.text']}: "/>
                        <br/>
                        <p:inputTextarea id="inText" 
                                         maxlength="255"
                                         autoResize="false"
                                         style="width: 350px; height: 100px"
                                         value="#{privateMessageBean.privateMessage.text}" 
                                         title="#{component.valid ? '' : privateMessageBean.getErrorMessage(component.clientId)}"/>
                    </div>
                </div>
                <div class="rigth-form-box">
                    <div class="form-cell">
                        <h:outputText value="#{i18n['private-message.form.receipts']}: "/>
                    </div>
                    <div class="form-cell">
                        <p:dataTable id="usersList" 
                                     rows="6"
                                     var="user"
                                     paginator="true"
                                     paginatorPosition="bottom"
                                     paginatorAlwaysVisible="false" 
                                     value="#{privateMessageBean.users}" 
                                     emptyMessage="#{i18n['private-message.form.list.no-users']}">
                            <p:column style="text-align: center"
                                      headerText="#{i18n['private-message.form.list.select']}">
                                <p:selectBooleanCheckbox value="#{user.selected}" 
                                                         disabled="#{privateMessageBean.viewState ne 'ADD'}"/>
                            </p:column>
                            <p:column width="80%"
                                      headerText="#{i18n['private-message.form.list.name']}">
                                #{user.name}
                            </p:column>
                        </p:dataTable>
                    </div>
                    <div class="form-cell">
                        <p:selectBooleanCheckbox value="#{privateMessageBean.selectAll}" 
                                                 disabled="#{privateMessageBean.viewState ne 'ADD'}"
                                                 itemLabel="#{i18n['private-message.form.select-all']}">
                            <p:ajax listener="#{privateMessageBean.onUserSelectionChange()}"/>
                        </p:selectBooleanCheckbox>
                    </div>
                </div>

                <div class="form-controls-box">
                    <p:commandButton styleClass="green-button"
                                     update="privateMessageForm"
                                     process="privateMessageForm"
                                     value="#{i18n['form.send']}"
                                     onstart="PF('loadingUI').show()"
                                     oncomplete="PF('loadingUI').hide()"
                                     action="#{privateMessageBean.doSave()}"
                                     rendered="#{privateMessageBean.viewState eq 'ADD'}"/>
                    <p:spacer width="10"/>
                    <p:commandButton immediate="true"
                                     styleClass="red-button"
                                     value="#{i18n['form.back']}"
                                     action="#{privateMessageBean.doCancel()}"/>
                </div>
            </h:panelGroup>
        </h:form>
        
        <p:blockUI widgetVar="loadingUI" 
                   block=":privateMessageForm:formWrappper">
            <p:graphicImage width="32" 
                            height="32"
                            library="images" 
                            name="ui-loading.gif" />
            <div style="margin-top: 5px">
                    #{i18n['private-message.form.sending']}
            </div>
        </p:blockUI>
    </ui:define>
</ui:composition>